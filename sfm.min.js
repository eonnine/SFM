/**
 * ******************
 * Simple File Manager *
 * ******************
 * License: MIT
 * Developed by Eg 2019-03-25
 */
(function(h){if("function"===typeof define&&define.amd)define(function(){return h});else if("object"===typeof module&&"object"===typeof module.exports)module.exports=h;else for(var e in h)this[e]=h[e]})(function(h,e){var f=Object.prototype.hasOwnProperty,d=function(a){if(!(this instanceof d))throw new SyntaxError('[SFM] "new" constructor operator is required');this.requiredValidator(a);this.fileMap=new h;this.isIngRemove=this.isIngDownload=this.isIngUpload=!1;this.fileAreaInnerHTML="";this.option=
a;this.callee={};this.init(a);return this.callee};d.prototype.requiredValidator=function(a){if(null==a||!f.call(a,"id"))throw new SyntaxError('[SFM] constructor property "id" is required');};d.prototype.config={key:{fileIdx:"number",fileSeq:"string"},fix:{item:"item",item_key_area:"item-key-area",file_upload:"upload-file",file_remove:"remove-file",file_download:"download-file",input_file:"input-file",item_area:"file-area"},file:{file_size:"52428800",file_count:0,file_extension:[],file_extension_except:[],
file_parameter_name:"file",file_list_parameter_name:"files"},message:{file_remove:"\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?",file_already_exist:"\ub3d9\uc77c\ud55c \uc774\ub984\uc758 \ud30c\uc77c\uc774 \uc774\ubbf8 \ub4f1\ub85d\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4",file_size_max_overflow:"\ud5c8\uc6a9\ub41c \ud06c\uae30(50mb)\ubcf4\ub2e4 \uc6a9\ub7c9\uc774 \ud070 \ud30c\uc77c\uc785\ub2c8\ub2e4",file_count_over:"\ud5c8\uc6a9\ub41c \uac1c\uc218\ub97c \ucd08\uacfc\ud569\ub2c8\ub2e4",file_extension:"\ud5c8\uc6a9\ub41c \ud655\uc7a5\uc790\uac00 \uc544\ub2d9\ub2c8\ub2e4.",
file_extension_except:"\ud5c8\uc6a9\ub41c \ud655\uc7a5\uc790\uac00 \uc544\ub2d9\ub2c8\ub2e4.",file_get_error:"\ud30c\uc77c \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294 \ub3c4\uc911 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.",file_upload_error:"\ud30c\uc77c \uc5c5\ub85c\ub4dc \ub3c4\uc911 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.",file_remove_error:"\ud30c\uc77c \uc0ad\uc81c \ub3c4\uc911 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.",file_download_error:"\ud30c\uc77c \ub2e4\uc6b4\ub85c\ub4dc \ub3c4\uc911 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.",
file_upload_is_ing:"\uc5c5\ub85c\ub4dc \uc911\uc785\ub2c8\ub2e4",file_remove_is_ing:"\uc0ad\uc81c \uc911\uc785\ub2c8\ub2e4",file_download_is_ing:"\ub2e4\uc6b4\ub85c\ub4dc \uc911\uc785\ub2c8\ub2e4"},layout:function(a,b){return'<fieldset><button id="'+b+'" style="float:right; position:relative; bottom:13px;">upload</button><div id="'+a+'" style="z-index:1;" width="100%" height="100%" default-class-dropzone><p>\ud30c\uc77c\uc744 \uc5ec\uae30\uc5d0 \ub4dc\ub798\uadf8\ud558\uac70\ub098 \ud074\ub9ad\ud558\uc138\uc694</p></div></fieldset>'},
item:function(a,b,c){return'<span style="z-index:10;"><p>&nbsp;&nbsp;<b id="'+c+'" style="width:12px; height:12px; margin-left:5px; font-size:12px; cursor:pointer;">\u25bc</b>&nbsp;file: <strong>'+a.name+"</strong>&nbsp;&nbsp;&nbsp;type: <strong>"+a.type+"</strong>&nbsp;&nbsp;&nbsp;size: <strong>"+a.size+'</strong>bytes<data style="display:none;"></data><b style="width:12px; height:12px; margin-left:5px; font-size:12px; cursor:pointer;" id="'+b+'">X</b></p></span>'},url:{file_get_list:"",file_upload:"",
file_remove:"",file_download:""},event:{file_upload:"click",file_remove:"click",file_download:"click"},eventHandler:{layout_create_after:function(a){var b=function(a){a.stopPropagation();a.preventDefault();a.target.className="mouseover"==a.type||"mouseenter"==a.type?"mhover":""},c=function(a){a.stopPropagation();a.preventDefault();a.target.className="dragover"==a.type||"dragenter"==a.type?"hover":""};a=a.fileArea;a.addEventListener("mouseover",b,!1);a.addEventListener("mouseenter",b,!1);a.addEventListener("mouseleave",
b,!1);a.addEventListener("dragover",c,!1);a.addEventListener("dragenter",c,!1);a.addEventListener("dragleave",c,!1)},file_upload_before:function(a){},file_upload_after:function(a){},file_remove_before:function(a){},file_remove_after:function(a){},file_download_before:function(){},file_download_after:function(a){}}};d.prototype.getConfig=function(){var a=this.searchProp(this.option,arguments);null===a&&(a=this.searchProp(this.config,arguments));return a};d.prototype.searchProp=function(a,b){var c,
g;for(c=0;g=b[c];c++)if(f.call(a,g))a=a[g];else return null;return a};d.prototype.setConfig=function(a){this.initConfig(a)};d.prototype.initConfig=function(a,b){b=b?b:this.config;for(var c in a)"fix"!==c&&("object"===typeof b[c]&&f.call(b,c)&&"Object"==b[c].constructor.name?this.initConfig(a[c],b[c]):b[c]=a[c])};d.prototype.getElement=function(a){return document.getElementById(a)};d.prototype.makeElementId=function(a){this.elementId=Object.create(null);this.elementId.item=this.makeConfigId("fix",
"item");this.elementId.fileArea=this.makeConfigId("fix","item_area");this.elementId.fileUpload=this.makeConfigId("fix","file_upload");this.elementId.fileRemove=this.makeConfigId("fix","file_remove");this.elementId.itemKeyArea=this.makeConfigId("fix","item_key_area");this.elementId.fileDownload=this.makeConfigId("fix","file_download");this.elementId.fileInputElement=this.makeConfigId("fix","input_file")};d.prototype.makeConfigId=function(){return this.addSeparator(this.option.id,this.getConfig.apply(this,
arguments))};d.prototype.addSeparator=function(){var a,b=arguments.length,c="";for(a=0;a<b;a++)c+=arguments[a]+"-";return c.slice(0,-1)};d.prototype.makeCallee=function(){this.callee.addFiles=this.addFiles.bind(this);this.callee.clear=this.clear.bind(this);this.callee.addFilesFromUrl=this.addFilesFromUrl.bind(this);this.callee.uploadFile=this.uploadFile.bind(this);this.callee.getNewFiles=this.getNewFiles.bind(this);this.callee.getFileToFormData=this.getFileToFormData.bind(this);this.callee.getNewFileToFormData=
this.getNewFileToFormData.bind(this)};d.prototype.freezeProperty=function(){var a={configurable:!1,enumerable:!1,writable:!1};Object.defineProperties(this.callee,{addFilesFromUrl:a,uploadFile:a,getNewFiles:a,getFileToFormData:a,getNewFileToFormData:a});Object.defineProperties(this,{fileMap:{configurable:!1,writable:!1},isIngUpload:{configurable:!1},isIngDownload:{configurable:!1},isIngRemove:{configurable:!1}})};d.prototype.init=function(a){this.makeElementId();this.createLayout();this.createDefaultEventListener();
this.makeCallee();this.freezeProperty()};d.prototype.createLayout=function(){var a=this.elementId.fileArea,b=this.elementId.fileUpload,c=this.getElement(this.option.id);c.innerHTML=this.getConfig("layout")(a,b);c.insertAdjacentHTML("afterbegin",'<input type="file" id="'+this.elementId.fileInputElement+'" multiple="multiple" style="display:none;"/>');a=this.getElement(a);b=this.getElement(b);this.fileAreaInnerHTML=a.innerHTML;null!=b&&this.addCustomEvent(b,this.getConfig("event","file_upload"),this.uploadFile.bind(this));
this.callConfigEventHandler("layout_create_after",{fileArea:a,fileUploadElement:b})};d.prototype.createDefaultEventListener=function(){var a=this.getElement(this.elementId.fileArea),b=this.getElement(this.elementId.fileInputElement);this.addCustomEvent(a,"click",this.openInputFile.bind(this)).addCustomEvent(a,"drop",this.addNewFile.bind(this)).addCustomEvent(a,"mouseover",this.preventEvent.bind(this)).addCustomEvent(a,"mouseenter",this.preventEvent.bind(this)).addCustomEvent(a,"dragover",this.preventEvent.bind(this)).addCustomEvent(a,
"mouseenter",this.preventEvent.bind(this)).addCustomEvent(b,"change",this.addNewFile.bind(this))};d.prototype.openInputFile=function(a){this.preventEvent(a);this.getElement(this.elementId.fileInputElement).click()};d.prototype.addNewFile=function(a){this.preventEvent(a);for(var b=a.target.files||a.dataTransfer.files,c=0,g;g=b[c];c++){if(!this.addFileStopValidator(g))return;var d=this.makeItemKey(g.name);g=this.createNewFile(g,d);this.removeDefaultHTML();this.addFileToFileMap(g,!0);this.addItem(g)}a.target.value=
""};d.prototype.addFileStopValidator=function(a){var b=a.name;b=b.substring(b.lastIndexOf(".")+1,b.length);var c=this.getConfig("file","file_extension"),g=this.getConfig("file","file_extension_except"),d=this.getConfig("file","file_count");if(a.size>this.getConfig("file","file_size"))return alert(this.getConfig("message","file_size_max_overflow")),!1;if(0!==d&&d<this.fileMap.size())return alert(this.getConfig("message","file_count_over")),!1;for(a=0;d=c[a];a++)if(b!==d)return alert(this.getConfig("message",
"file_extension")),!1;for(a=0;c=g[a];a++)if(b===c)return alert(this.getConfig("message","file_extension_except")),!1;return!0};d.prototype.createNewFile=function(a,b){var c=new Blob([a],{type:a.type});c.name=b;c.lastModified=a.lastModified||0;c.lastModifiedDate=a.lastModifiedDate||0;return c};d.prototype.makeItemKey=function(a){for(var b=a,c=1,g;this.fileMap.isContainsKey(b);)c++,g=a.substring(a.lastIndexOf("."),a.length),b=a.substring(0,a.lastIndexOf(".")),b=b+" ("+c+")"+g;return b};d.prototype.addFiles=
function(a){if(!Array.isArray(a))throw new SyntaxError("[SFM] argument type of `addFiles` must be Array");for(var b=0,c;c=a[b];b++)f.call(c,"name")?(this.removeDefaultHTML(),this.addFileToFileMap(c,!1),this.addItem(c)):console.error('[SFM] not exists attribute "name" in file object',c)};d.prototype.addFileToFileMap=function(a,b){a.isNewFile=b;this.fileMap.put(a.name,a)};d.prototype.removeDefaultHTML=function(){0==this.fileMap.length&&(this.getElement(this.elementId.fileArea).innerHTML="")};d.prototype.insertDefaultHTML=
function(){0==this.fileMap.length&&(this.getElement(this.elementId.fileArea).innerHTML=this.fileAreaInnerHTML)};d.prototype.addItem=function(a){var b=this.addSeparator(this.elementId.fileRemove,a.name),c=this.addSeparator(this.elementId.fileDownload,a.name),g=this.getElement(this.elementId.fileArea),d=this.getConfig("key"),f=this.elementId.itemKeyArea,e="",h=this.addSeparator(this.elementId.item,a.name),k=this.getConfig("item")(a,b,c);Object.keys(d).forEach(function(b,c){0===c&&(e="<span "+f+">");
e+='<input type="hidden" id="'+b+'" value="'+(a[b]?a[b]:"")+'"/>';c==d.length-1&&(e+="</span>")});g.insertAdjacentHTML("beforeend",'<span id="'+h+'">'+k+e+"</span>");b=this.getElement(b);c=this.getElement(c);b&&this.addCustomEvent(b,this.getConfig("event","file_remove"),this.removeFile.bind(this,h,this.createNewFile(a,a.name)));c&&this.addCustomEvent(c,this.getConfig("event","file_download"),this.downloadFile.bind(this,h,this.createNewFile(a,a.name)))};d.prototype.removeFile=function(a,b,c){if(this.isIngRemove)return alert(this.getConfig("message",
"file_remove_is_ing")),!1;if(!confirm(this.getConfig("message","file_remove")))return!1;this.isIngRemove=!0;this.preventEvent(c);var g=this;c=new e;var d=b.name,f=g.getElement(a),h=g.makeParamFile(b),k=g.getConfig("url","file_remove");c.error(function(a){console.error("[SFM] fail remove file:",k,a);g.isIngRemove=!1;alert(g.getConfig("message","file_remove_error"))});c.then(function(a,c){g.callConfigEventHandler("file_remove_before",{file:b,item:f})?a():c()}).then(function(a,b){null==k||""===g.trim(k)?
a():g.ajax.post(k,h,function(b,c,g){a([b,c,g])},function(a){b();throw Error();})}).then(function(a,b,c){g.removeSelf(f);g.fileMap.remove(d);g.callConfigEventHandler("file_remove_after",c);g.isIngRemove=!1;g.insertDefaultHTML()})};d.prototype.downloadFile=function(a,b,c){this.isIngDownload=!0;this.preventEvent(c);var g=this;c=new e;var d=g.getElement(a),f=g.getConfig("url","file_download");c.error(function(a){console.error("[SFM] fail download file:",f,a);alert(g.getConfig("message","file_download_error"))});
c.then(function(a,c){g.callConfigEventHandler("file_download_before",{file:b,item:d})?a():c()}).then(function(a,b){if(null==f||""==g.trim(f))console.warn("[SFM] downloadURL is not define"),a();else try{location.href=f,a()}catch(l){throw b(),Error();}}).then(function(){g.callConfigEventHandler("file_download_after");g.isIngDownload=!1})};d.prototype.uploadFile=function(){if(this.isIngUpload)return alert(this.getConfig("message","file_upload_is_ing")),!1;this.isIngUpload=!0;var a=this,b=new e,c=a.makeParamFiles(null,
!0),g=a.getConfig("url","file_upload");b.error(function(b){console.error("[SFM] fail upload:",g,b);a.isIngUpload=!1;alert(a.getConfig("message","file_upload_error"))});b.then(function(b,c){a.callConfigEventHandler("file_upload_before")?b():c()}).then(function(b,d){null==g||""===a.trim(g)||0==a.fileMap.length?b():a.ajax.post(g,c,function(a,c,d){b([a,c,d])},function(a){d();throw Error();})}).then(function(b,c,d){a.callConfigEventHandler("file_upload_after",d);a.isIngUpload=!1})};d.prototype.removeSelf=
function(a){a.parentNode.removeChild(a)};d.prototype.makeParamFile=function(a){var b=new FormData;this.setParamFormData(b,a,!1);return b};d.prototype.makeParamFiles=function(a,b){a=a?a:new FormData;var c=this.fileMap.array(),d=0;b=b?b:!1;c.forEach(function(c){if(!b||b&&c.isNewFile)this.setParamFormData(a,c,!0,d,b),d++}.bind(this));return a};d.prototype.setParamFormData=function(a,b,c,d){var g=this.addSeparator(this.elementId.item,b.name);g=this.getElement(g).querySelector("["+this.elementId.itemKeyArea+
"]").childNodes;var e=this.getConfig("key"),h;for(h=0;h<g.length;h++){var k=g[h];f.call(e,k.id)&&a.append(this.getParamName(c,!1,d,k.id),"number"===e[k.id].toLowerCase()?Number(k.value):String(k.value))}a.append(this.getParamName(c,!0,d),b,b.name)};d.prototype.getParamName=function(a,b,c,d){c=this.getConfig("file","file_list_parameter_name")+"["+c+"].";var g=this.getConfig("file","file_parameter_name");return a?b?c+g:c+d:b?g:d};d.prototype.getFileToFormData=function(a){return this.makeParamFiles(a)};
d.prototype.getNewFileToFormData=function(a){return this.makeParamFiles(a,!0)};d.prototype.addFilesFromUrl=function(a){var b=this.getConfig("url","file_get_list"),c=this;c.ajax.get(b,a,function(a){c.addFiles(a)},function(a){console.error("[SFM] addFilesFromUrl:",b,a);alert(c.getConfig("message","file_get_error"))})};d.prototype.getFiles=function(){var a=[];this.fileMap.each(function(b,c){a.push(b.value)});return a};d.prototype.getNewFiles=function(){var a=[];this.fileMap.each(function(b,c){b.value.isNewFile&&
a.push(b.value)});return a};d.prototype.addCustomEvent=function(a,b,c){void 0===a._$sfmEventListeners&&(a._$sfmEventListeners=Object.create(null));a._$sfmEventListeners[b]=function(a){a.stopPropagation();a.preventDefault();c(a)};a.addEventListener(b,a._$sfmEventListeners[b],!1);f.call(a._$sfmEventListeners,"DOMNodeRemovedFromDocument")||this.addCustomEvent(a,"DOMNodeRemovedFromDocument",function(a){this._$sfmEventListeners&&(Object.keys(this._$sfmEventListeners).forEach(function(a){this.removeEventListener(a,
this._$sfmEventListeners[a]);delete this._$sfmEventListeners[a]}.bind(this)),delete this._$sfmEventListeners)}.bind(this));return this};d.prototype.callConfigEventHandler=function(a,b){var c=this.option;var d=this.searchProp(this.config,["eventHandler",a]);var e=c.eventHandler[a];d=Array.isArray(b)?d.apply(this.callee,b):d.call(this.callee,b);!1!==d&&f.call(c,"eventHandler")&&f.call(c.eventHandler,a)&&(d=Array.isArray(b)?e.apply(this.callee,b):e.call(this.callee,b));return!1===d?!1:!0};d.prototype.preventEvent=
function(a){a.stopPropagation();a.preventDefault()};d.prototype.copyObject=function(a){var b={};if("string"===typeof a)b=a;else for(var c in a)b[c]=a[c];return b};d.prototype.clear=function(){this.getElement(this.elementId.fileArea).innerHTML="";this.fileMap.clear();this.insertDefaultHTML()};d.prototype.trim=function(a){return a.replace(/\s/g,"")};d.prototype.ajax={get:function(a,b,c,d){this.xhr("GET",a,b,c,d)},post:function(a,b,c,d){this.xhr("POST",a,b,c,d)},xhr:function(a,b,c,d,f){var e=window.XMLHttpRequest?
new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onload=function(a){4==this.readyState&&200==this.status?d&&d(a.target.response,a,e):f&&f(e)};e.open(a,b,!0);e.setRequestHeader("encType","multipart/form-data");e.send(c)}};var k=function(a){if(!(this instanceof k))throw new SyntaxError('[SFMGrid] "new" constructor operator is required');this.requiredValidator(a);this.fileMap=Object.create(null);this.rowIdColumn=a.rowIdColumn;this.listParameterName=a.listParameterName;this.fileParameterName=
a.fileParameterName||"file";this.callee={};this.init();return this.callee};k.prototype.requiredValidator=function(a){if(null==a||!f.call(a,"rowIdColumn"))throw new SyntaxError('[SFMGrid] constructor property "rowIdColumn" is required');if(!f.call(a,"listParameterName"))throw new SyntaxError('[SFMGrid] constructor property "listParameterName" is required');f.call(a,"fileParameterName")||console.warn('[SFMGrid] constructor property "fileParameterName" is not define')};k.prototype.init=function(){this.makeCallee()};
k.prototype.makeCallee=function(){this.callee.get=this.get.bind(this);this.callee.set=this.set.bind(this);this.callee.remove=this.remove.bind(this);this.callee.clear=this.clear.bind(this);this.callee.getFormDataFromObject=this.getFormDataFromObject.bind(this);this.callee.getFormDataFromArray=this.getFormDataFromArray.bind(this)};k.prototype.get=function(a){return this.fileMap[a[this.rowIdColumn]]};k.prototype.set=function(a,b){this.fileMap[a[this.rowIdColumn]]=b};k.prototype.remove=function(a){delete this.fileMap[a[this.rowIdColumn]]};
k.prototype.clear=function(a){this.fileMap.clear()};k.prototype.getFormDataFromObject=function(a){a=new FormData;for(var b in this.fileMap)this.rowIdColumn===b&&f.call(this.fileMap,this.fileMap[this.rowIdColumn])&&a.append(this.fileParameterName,this.fileMap[this.fileMap[this.rowIdColumn]]),a.append(b,this.fileMap[b]);return a};k.prototype.getFormDataFromArray=function(a){if(0==a.length)return null;var b=this,c=new FormData,d=this.copyObject(this.fileMap);a.forEach(function(a,e){for(var g in a)b.rowIdColumn===
g&&f.call(d,a[b.rowIdColumn])&&(c.append(b.listParameterName+"["+e+"]."+b.fileParameterName,d[a[b.rowIdColumn]]),delete d[a[b.rowIdColumn]]),c.append(b.listParameterName+"["+e+"]."+g,a[g])});return c};k.prototype.copyObject=function(a){var b={},c;for(c in a)b[c]=a[c];return b};return{SFM:d,SFMGrid:k}}(function(){var h=function(){this.tail=this.head=null;this.map=Object.create(null);this.length=0;this.hasProp=Object.prototype.hasOwnProperty};h.prototype.clear=function(){this.tail=this.head=null;this.map=
Object.create(null);this.length=0};h.prototype.get=function(e){return(this.hasProp.call(this.map,e)?this.map[e]:{}).value};h.prototype.size=function(){return this.map.length};h.prototype.getByIndex=function(e){return this.getItemByIndex(e).value};h.prototype.getIndexByKey=function(e){return this.getItemByKey(e).index};h.prototype.getItemByKey=function(e){var f=null;this.each(function(d,h){if(e===d.key)return f={index:h,key:d.key,value:d.value},!1});return f};h.prototype.getItemByIndex=function(e){var f=
null;this.each(function(d,h){if(e==h)return f={index:h,key:d.key,value:d.value},!1});return f};h.prototype.isContainsKey=function(e){return this.hasProp.call(this.map,e)?!0:!1};h.prototype.put=function(e,f){this.remove(e);var d={key:e,value:f,prev:this.tail,next:null};this.map[e]=d;0===this.length&&(this.head=d);this.tail&&(this.tail.next=d);this.tail=d;this.length+=1};h.prototype.remove=function(e){if(this.hasProp.call(this.map,e)){var f=this.map[e];this.head===f&&(f.next&&(f.next.prev=null),this.head=
f.next);this.tail===f&&(f.prev&&(f.prev.next=null),this.tail=f.prev);f.next&&(f.next.prev=f.prev);f.prev&&(f.prev.next=f.next);delete this.map[e];--this.length}};h.prototype.each=function(e){for(var f=0,d=this.length,h=this.head,a;f<d;){a={key:h.key,value:h.value};if(!1===e(a,f))break;h=h.next;f++}};h.prototype.eachRvs=function(e){for(var f=this.length,d=this.tail,h;0<f;){h={key:d.key,value:d.value};if(!1===e(h,f))break;d=d.prev;f--}};h.prototype.array=function(){var e=[];this.each(function(f,d){e.push(f.value)});
return e};h.prototype.arrayRvs=function(){var e=[];this.reverseEach(function(f,d){e.push(f.value)});return e};return h}(),function(){var h=function(){this.queue=[];this.isIng=!1;this.onReject=this.onError=null};h.prototype.run=function(e){if(0<this.queue.length&&!this.isIng){this.isIng=!0;try{this.queue.shift()(this.makeResolve(),this.makeReject(),e)}catch(f){this.onError?this.onError(f):console.error(f.message)}}};h.prototype.then=function(e){this.queue.push(e);this.run();return this};h.prototype.error=
function(e){this.onError=e;return this};h.prototype.stop=function(){this.queue=[];this.isIng=!1};h.prototype.reject=function(e){this.onReject=e;return this};h.prototype.makeResolve=function(){return function(e){this.isIng=!1;this.run(e)}.bind(this)};h.prototype.makeReject=function(){return function(e){this.stop();if(this.onReject)this.onReject(e)}.bind(this)};return h}()));